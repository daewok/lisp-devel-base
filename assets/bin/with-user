#! /bin/bash

set -e

_USER=lisp
_UID=1000

while getopts ":u:i:" opt; do
    case $opt in
        u)
            _USER=$OPTARG
            _MAKE_USER="yes"
            ;;
        i)
            _UID=$OPTARG
            _MAKE_USER="yes"
            ;;
        \?)
            echo "invalid option."
            exit 1
            ;;
    esac
done

shift $((OPTIND-1))

if [ -n "$_USER" ]; then
    # Make the user if it doesn't exist.
    getent passwd "${_USER}" > /dev/null || adduser --gecos "Autogenerated Lisp user." --disabled-password --ingroup users --uid "$_UID" "$_USER"
    exec su -c "$@" "$_USER"
else
    exec $@
fi
